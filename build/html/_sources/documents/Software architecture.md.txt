<img align="right" width="100px" src="../_images/Foundation29.png">

# Software architecture

## Introduction

Health29's architecture uses a client-server software design model.

![Alt](../images/H29_architecture.jpg "H29 architecture")

For the client we use the Angular 5 framework, and for the nodejs - express server, in which we have implemented an API to connect to the CosmoDb databases using mongoose for its management.

For Android and iOS apps, we use the cordova framework. When compiling the Angular project, it generates the dist folder, which is the one to be added to the www folder of the Corova project.  We were evaluating ionic, nativescript and reactscript, they would be good options if we were more people, but at the moment we fit more cordova.

Our idea is to migrate to FHIR, so we would have to modify our API to make calls to [FHIR's API](https://www.hl7.org/fhir/ "Title")

Health29 provides a web API to access the data. Anyone can develop an application to access and modify the data of a Health29 user. OAuth 2.0 is used as an authorization protocol to give an API client limited access to the user's data. 

## General schema

We will use the C4 model to expose the software architecture. Thus, in the description of this section we will differentiate between:

- Level 1: A **System Context** diagram provides a starting point, showing how the software system in scope fits into the world around it.
- Level 2: A **Container** diagram zooms into the software system in scope, showing the high-level technical building blocks.
- Level 3: A **Component** diagram zooms into an individual container, showing the components inside it.
- Level 4: A **code** (e.g. UML class) diagram can be used to zoom into an individual component, showing how that component is implemented.

![Alt](../images/H29_C4model.png "H29 C4 model")

## Level 1: System Context
TODO 

## Level 2: Containers

Health29 consists of several connected containers.
We have divided them according to their functionality and use within the platform.Thus, we will have:

- Webapp container.
- External APIs container.
- Azure cognitive services container.
- Azure healthbot container.
- Azure blobs container.
- Databases container.

These modules are intercommunicated using a REST interface, that is, the communication is established according to the HTTP protocol. 

(Esquema general de comunicación entre los containers)

## Level 3: Component

Taking into account the division by containers exposed in the previous point, we are now going to study in detail the internal architecture and the components that make up each one of them.

### Webapp
![Alt](../images/Webapp.jpg "Webapp")

This container will be composed of the platform's webapp services,
- The client or frontend
- The server or backend

These two modules are intercommunicated using a REST interface, that is, the communication is established according to the HTTP protocol. 

(TODO: Explicar un poco mas aqui a nivel de sistema)

In turn, the server is connected with the rest of the services offered by the Health29 platform. That is to say, this is the one that establishes communication with the rest of the containers to obtain the necessary information and transfer it to the client. 

(TODO: Introducir que esto se va a ir explicando con el resto de containers indicando en cada caso si se conecta al cliente o al servidor)

As the client is using the Angular 5 framework, when compiling it (ng build) you get a "/dist" folder that must be included in the server for the construction of the platform.

### External APIs
TODO

### Azure cognitive services
#### Computer Vision
It is used in the symptoms section. This service converts images into text in order to obtain the symptoms.
It is used from the webapp container client.
You can configure and use this azure service by following the steps in the [Microsoft guide](https://docs.microsoft.com/bs-latn-ba/azure/cognitive-services/computer-vision/). And access the one that uses the Health29 platform from this [link](https://portal.azure.com/#@foundation29outlook.onmicrosoft.com/resource/subscriptions/53348303-e009-4241-9ac7-a8e4465ece27/resourceGroups/health29/providers/Microsoft.CognitiveServices/accounts/recognizetexthealth29/overview).

#### Qna maker
QnA Maker is a cloud-based Natural Language Processing (NLP) service that easily creates a natural conversation layer with the data. 

In Health29 it is used to manage the FAQs in different ways and from different points of the platform:

- To show the list of FAQs to the **users**. From the user profile you can access the FAQ page where you will be shown the results of the service consultation in the form of a list.

- So that the **administrators** of the platform can manage the list of FAQs. From the administrator profile you can add, delete and edit the list of FAQs of the service.

- It is integrated into the **healthbot** to allow users to ask questions or doubts in a more guided and personal way. 

In this case the communication of the webapp with this service is requested from the client through an external API that acts as an intermediary. However, there will also be information that will be stored in the databases, therefore, the client will also establish a communication with the server who will manage the storage of this information.

You can configure and use this azure service by following the steps in the [Microsoft guide](https://docs.microsoft.com/en-us/azure/cognitive-services/qnamaker/).And access the one that uses the Health29 platform from this [link](https://portal.azure.com/#@foundation29outlook.onmicrosoft.com/resource/subscriptions/53348303-e009-4241-9ac7-a8e4465ece27/resourceGroups/health29/providers/Microsoft.CognitiveServices/accounts/qnamakerhealth29/overview)

In particular for Health29 the following databases have been created in qnamaker: [My knowledge bases](https://www.qnamaker.ai/Home/MyServices). One would be created for each group of patients to contain their specific information and this in turn would be replicated in as many languages as the question-answer pairs are translated on the Health29 platform.


#### Translator
-	Traductor para poder realizar una tradución de los distintos datapoints, para añadir un nuevo idioma a la plataforma (traduce todas las etiquetas), y para traducir a inglés el texto obtenido del servicio vision para llamar el servicio NCR que extrae los síntomas (también incluido en dx29). 

### Azure healthbot
TODO

### Azure blobs
TODO
-	En los blobs de azure, cada paciente tiene su blob donde se guardan pruebas médicas. 
Se hace desde el cliente

### Databases
TODO
(DOC health29_DBs)


## Level 4: Code
TODO
